<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helen and Colin's Year on the Road</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .content-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background: #f5f5f5;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .view-tabs {
            display: flex;
            background: #fff;
            border-bottom: 1px solid #ddd;
        }

        .view-tab {
            flex: 1;
            padding: 16px 10px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .view-tab:hover {
            background: #f0f0f0;
        }

        .view-tab.active {
            background: #f5f5f5;
            border-bottom: 2px solid #007bff;
        }

        .location-list {
            overflow-y: auto;
            flex: 1;
        }

        .location-item {
            padding: 16px 18px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .location-item:hover {
            background: #e8e8e8;
        }

        .location-item.active {
            background: #007bff;
            color: white;
        }

        .location-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .location-location {
            font-weight: 400;
            color: #666;
            font-size: 12px;
        }

        .location-sites {
            font-weight: 400;
            color: #222222;
            font-size: 12px;
        }

        .location-date {
            font-size: 12px;
            color: #666;
        }

        .location-item.active .location-date {
            color: #e0e0e0;
        }

        .main-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        #blog {
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
            display: none;
            max-width: 800px;
            margin: 0 auto;
        }

        .blog-entry {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e0e0e0;
        }

        .blog-entry:last-child {
            border-bottom: none;
        }

        .blog-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .blog-location {
            font-size: 16px;
            color: #888;
            margin-bottom: 6px;
        }
        
        .blog-sites {
            font-size: 16px;
            color: #888;
            margin-bottom: 6px;
        }

        .blog-date {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .blog-content {
            line-height: 1.6;
            color: #333;
        }

        .blog-photos {
            margin-top: 20px;
        }

        .blog-photos figure {
            margin-bottom: 20px;
        }

        .blog-photos img {
            width: 100%;
            border-radius: 4px;
        }

        .blog-photos figcaption {
            font-size: 13px;
            color: #666;
            margin-top: 6px;
        }

        .blog-separator {
            margin-top: 30px;
            border: none;
            border-top: 1px solid #e0e0e0;
        }

        .popup-carousel {
            position: relative;
            margin-top: 12px;
            text-align: center;
        }

        .popup-carousel img {
            width: 100%;
            border-radius: 4px;
        }

        .popup-carousel .caption {
            font-size: 13px;
            color: #555;
            margin-top: 6px;
        }

        .carousel-nav {
            position: absolute;
            top: 45%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            font-size: 20px;
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 3px;
        }

        .carousel-nav.prev {
            left: 6px;
        }

        .carousel-nav.next {
            right: 6px;
        }

        .carousel-nav:hover {
            background: rgba(0, 0, 0, 0.85);
        }


        .carousel {
            position: relative;
            margin-top: 15px;
            text-align: center;
        }

        .carousel img {
            width: 100%;
            border-radius: 4px;
        }

        .carousel .caption {
            font-size: 13px;
            color: #555;
            margin-top: 5px;
        }

        .carousel button {
            position: absolute;
            top: 45%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            font-size: 18px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .carousel .prev {
            left: 5px;
        }

        .carousel .next {
            right: 5px;
        }

        .sidebar-toggle {
            display: none;
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: scroll;
        }

        .popup-overlay.show {
            display: flex;
        }

        .popup-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .popup-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .popup-date {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .popup-summary {
            line-height: 1.6;
            color: #333;
        }

        .popup-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        /* Photo strip */
        .photo-strip {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
            margin-top: 24px;
        }

        .photo-strip img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .photo-strip img:hover {
            transform: scale(1.04);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        .popup-photo-strip {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .popup-photo-strip img {
            width: 100%;
            height: 90px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.15s ease;
        }

        .popup-photo-strip img:hover {
            transform: scale(1.05);
        }


        /* Modal */
        .photo-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            flex-direction: column;
        }

        .photo-modal.show {
            display: flex;
        }

        .photo-modal img {
            max-width: 90%;
            max-height: 80%;
        }

        .photo-modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 32px;
            color: white;
            cursor: pointer;
        }

        .modal-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            font-size: 36px;
            padding: 8px 14px;
            cursor: pointer;
            border-radius: 4px;
            user-select: none;
        }

        .modal-nav.prev {
            left: 20px;
        }

        .modal-nav.next {
            right: 20px;
        }

        .modal-nav:hover {
            background: rgba(0, 0, 0, 0.85);
        }


        #photoModalCaption {
            color: #ccc;
            margin-top: 12px;
            font-size: 14px;
        }


        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .content-wrapper {
                flex: 1;
                position: relative;
            }

            .sidebar {
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 85%;
                max-width: 320px;
                z-index: 1001;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.25);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                flex: 1;
            }

            .sidebar-toggle {
                position: fixed;
                top: 12px;
                right: 12px;
                left: auto;
                z-index: 1100;
                background: white;
                border: none;
                padding: 10px 12px;
                border-radius: 999px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
                font-size: 18px;
                cursor: pointer;
                display: block;
            }

            .popup-content {
                width: 90%;
                max-height: 85vh;
                padding: 20px;
            }
        }

        .popup-summary img,
        .blog-content img,
        .leaflet-popup {
            position: absolute;
            text-align: center;
        }
        .leaflet-popup-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 10px 0;
            border-radius: 4px;
        }

        .leaflet-popup-content-wrapper {
            max-height: 75vh;
            overflow-y: auto;
        }

        .leaflet-control.leaflet-bar {
            margin-top: 6px;
        }

        /* Bottom banner embed fix */
        [data-uid="20129ba78a"] {
            position: fixed !important;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            z-index: 3000;
        }


    </style>
</head>

<body>
    <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>
    <div class="content-wrapper">
    <div class="sidebar">
        <div class="view-tabs">
            <button class="view-tab" data-view="map">Map</button>
            <button class="view-tab active" data-view="blog">Blog</button>
        </div>
        <div class="location-list" id="locationList"></div>
    </div>

    <div class="main-content">
        <div id="map"></div>
        <div id="blog"></div>
    </div>
    </div>

    <div id="photoModal" class="photo-modal">
        <button class="modal-nav prev">‚Äπ</button>
        <img id="photoModalImg" loading="lazy">
        <button class="modal-nav next">‚Ä∫</button>

        <div id="photoModalCaption"></div>
        <span class="photo-modal-close">√ó</span>
    </div>

    <script>
        let locations = [];
        let map;
        let markers = [];
        let currentView = 'blog';
        let selectedIndex = null;

        async function init() {
            try {
                const [locsResponse, coordsResponse] = await Promise.all([
                    fetch('./locs.json'),
                    fetch('./locs-coords.json')
                ]);

                locations = await locsResponse.json();
                const coords = await coordsResponse.json();

                console.log(coords[coords.length - 1]);
                console.log(locations[locations.length - 1])
                // Merge coordinates
                locations.forEach(loc => {
                    const cached = coords.find(c =>
                        c.location === loc.location
                    );

                    if (cached) {
                        loc.lat = cached.lat;
                        loc.lng = cached.lng;
                    } else {
                        loc.rm = true;
                    }
                });

                locations = locations.filter(loc => !loc.rm);

                initMap();
                populateSidebar();
                setupViewTabs();
                switchView('blog');
            } catch (error) {
                console.error('Error loading locations:', error);
            }
        }

        function isMobile() {
            return window.innerWidth <= 768;
        }

        let modalPhotos = [];
        let modalIndex = 0;

        function openPhotoModal(photos, startIndex) {
            modalPhotos = photos;
            modalIndex = startIndex;
            updateModal();
            document.getElementById('photoModal').classList.add('show');
        }

        function updateModal() {
            const img = document.getElementById('photoModalImg');
            const cap = document.getElementById('photoModalCaption');
            
            if (!modalPhotos || !modalPhotos[modalIndex]) {
                return;
            }
            
            img.src = modalPhotos[modalIndex].src;
            cap.textContent = modalPhotos[modalIndex].caption || '';
        }

        function moveModal(d) {
            modalIndex = (modalIndex + d + modalPhotos.length) % modalPhotos.length;
            updateModal();
        }


        function closeSidebarOnMobile() {
            if (isMobile()) {
                document.querySelector('.sidebar').classList.remove('open');
            }

            setTimeout(() => {
                if (map) map.invalidateSize();
            }, 350);

        }

        document.getElementById('sidebarToggle').addEventListener('click', () => {
            document.querySelector('.sidebar').classList.toggle('open');
        });

        document.querySelector('.modal-nav.prev').onclick = () => moveModal(-1);
        document.querySelector('.modal-nav.next').onclick = () => moveModal(1);

        document.addEventListener('keydown', e => {
            const modal = document.getElementById('photoModal');
            if (!modal.classList.contains('show')) {
                return;
            }
            if (e.key === 'ArrowLeft') moveModal(-1);
            if (e.key === 'ArrowRight') moveModal(1);
            if (e.key === 'Escape') modal.classList.remove('show');
        });


        function stripPhotoTokens(text) {
            return text
                ? text.replace(/\{photo\d+\}/g, '')
                : '';
        }

        function renderPopupCarousel(photos) {
            if (!photos || photos.length === 0) {
                return '';
            }

            return `
                <div class="popup-carousel" data-index="0">
                    <button class="carousel-nav prev">‚Äπ</button>
                    <img data-src="${photos[0].pth}" loading="lazy">
                    <button class="carousel-nav next">‚Ä∫</button>
                    <div class="caption">${photos[0].caption || ''}</div>
                </div>
            `;
        }


        function initMap() {
            map = L.map('map').setView([36.5, -112], 5);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // Custom icons
            const homeIcon = L.divIcon({
                html: '<div style="font-size: 24px;">üè†</div>',
                className: 'custom-icon',
                iconSize: [30, 30],
                iconAnchor: [15, 30]
            });

            const vanIcon = L.divIcon({
                html: '<div style="font-size: 24px;">üöê</div>',
                className: 'custom-icon',
                iconSize: [30, 30],
                iconAnchor: [15, 30]
            });

            const pinIcon = L.divIcon({
                html: '<div style="font-size: 24px;">üìç</div>',
                className: 'custom-icon',
                iconSize: [30, 30],
                iconAnchor: [15, 30]
            });

            const routeCoords = locations.map(loc => [loc.lat, loc.lng]);

            // Dashed line to look like rope/string
            L.polyline(routeCoords, {
                color: '#8B4513',
                weight: 3,
                dashArray: '10, 5',
                lineCap: 'round'
            }).addTo(map);

            locations.forEach((loc, index) => {
                let icon;
                if (index === 0) {
                    icon = homeIcon;
                } else if (index === locations.length - 1) {
                    icon = vanIcon;
                } else {
                    icon = pinIcon;
                }

                const marker = L.marker([loc.lat, loc.lng], { icon }).addTo(map);

                const popupContent = `
                    <strong>Stop ${index + 1}: ${loc.location}</strong><br>
                    ${loc.campsites ? `<div style="font-size: 14px; color: #555; margin-bottom: 6px;"><strong>Campsites:</strong> ${loc.campsites.join(', ')}</div>` : ''}
                    <small>${formatDate(loc.date_start)} - ${formatDate(loc.date_end)}</small><br><br>
                    ${stripPhotoTokens(loc.summary)}
                    ${renderPopupCarousel(loc.photos)}
                `;
                marker.bindPopup(popupContent);

                marker.on('popupopen', e => {
                    const popupEl = e.popup.getElement();

                    popupEl.querySelectorAll('img[data-src]').forEach(img => {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                    });

                    const carousel = popupEl.querySelector('.popup-carousel');
                    if (carousel) {
                        attachPopupCarouselHandlers(carousel, loc.photos);
                    }

                    const popup = e.popup;
                    var px = map.project(popup.getLatLng());
                    px.y -= popup._container.clientHeight / 2;
                    map.panTo(map.unproject(px), { animate: true });
                });


                markers.push(marker);
            });


            if (routeCoords.length > 0) {
                map.fitBounds(routeCoords);
            }

            addPrevNextControls();
        }

        function addPrevNextControls() {
            const PrevNextControl = L.Control.extend({
                options: {
                    position: 'topleft'
                },

                onAdd() {
                    const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');

                    const prevBtn = L.DomUtil.create('a', '', container);
                    prevBtn.innerHTML = '‚ü®';
                    prevBtn.title = 'Previous stop';

                    const nextBtn = L.DomUtil.create('a', '', container);
                    nextBtn.innerHTML = '‚ü©';
                    nextBtn.title = 'Next stop';

                    L.DomEvent.disableClickPropagation(container);

                    prevBtn.onclick = () => goToRelativeStop(-1);
                    nextBtn.onclick = () => goToRelativeStop(1);

                    return container;
                }
            });

            map.addControl(new PrevNextControl());
        }

        function goToRelativeStop(delta) {
            if (selectedIndex === null) {
                selectLocation(0);
                return;
            }

            let next = selectedIndex + delta;
            next = Math.max(0, Math.min(locations.length - 1, next));

            if (next !== selectedIndex) {
                selectLocation(next);
            }
        }


        function populateSidebar() {
            const list = document.getElementById('locationList');
            list.innerHTML = locations.map((loc, index) => {
                console.log(`Rendering location ${index}:`, loc);
                return `
                    <div class="location-item" data-index="${index}">
                        <div class="location-name">${loc.title && loc.title.trim() ? loc.title : loc.location}</div>
                        ${loc.title ? `<div class="location-location">${loc.location}</div>` : ''}
                        <div class="location-date">${formatDate(loc.date_start)}</div>
                    </div>
                `;
            }).join('');
            console.log('Sidebar populated with', locations.length, 'locations');

            document.querySelectorAll('.location-item').forEach(item => {
                item.addEventListener('click', () => {
                    const index = parseInt(item.dataset.index);
                    selectLocation(index);
                });
            });
        }

        function selectLocation(index) {
            selectedIndex = index;

            document.querySelectorAll('.location-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });

            const loc = locations[index];

            if (currentView === 'map') {
                map.flyTo([loc.lat, loc.lng], 10, {
                    duration: 0.75
                });
                setTimeout(() => markers[index].openPopup(), 500);
            } else if (currentView === 'blog') {
                const blogEntries = document.querySelectorAll('.blog-entry');
                const visibleLocations = locations.filter(l => l.summary);
                const blogIndex = visibleLocations.findIndex((_, i) => locations.indexOf(visibleLocations[i]) === index);
                if (blogIndex >= 0 && blogEntries[blogIndex]) {
                    blogEntries[blogIndex].scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }

            closeSidebarOnMobile();
        }

        function setupViewTabs() {
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const view = tab.dataset.view;
                    switchView(view);
                });
            });
        }

        function switchView(view) {
            currentView = view;

            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.view === view);
            });

            document.getElementById('map').style.display = view === 'map' ? 'block' : 'none';
            document.getElementById('blog').style.display = view === 'blog' ? 'block' : 'none';

            if (view === 'blog') {
                populateBlog();
            } else if (view === 'map') {
                setTimeout(() => map.invalidateSize(), 100);
            }

            // Re-apply selection
            if (selectedIndex !== null) {
                selectLocation(selectedIndex);
            }
        }

        function renderBlogPhotoStrip(photos) {
            if (!photos || photos.length === 0) {
                return '';
            }

            return `
                <div class="photo-strip">
                    ${photos.map((p, i) => `
                        <img
                            data-src="${p.pth}"
                            alt="${p.caption || ''}"
                            data-index="${i}"
                            loading="lazy"
                        >
                    `).join('')}
                </div>
            `;
        }

        function setupBlogLazyLoading() {
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (!entry.isIntersecting) {
                        return;
                    }

                    const img = entry.target;

                    // Require 0.5s of visibility
                    const timer = setTimeout(() => {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        observer.unobserve(img);
                    }, 250);

                    // Cancel if user scrolls away
                    img._lazyTimer = timer;
                });
            }, {
                root: document.getElementById('blog'),
                threshold: 0.25
            });

            document.querySelectorAll('#blog img[data-src]').forEach(img => {
                observer.observe(img);
            });
        }


        function attachPopupCarouselHandlers(carousel, photos) {
            if (!photos || photos.length <= 1) {
                return;
            }

            let idx = 0;
            const img = carousel.querySelector('img');
            const caption = carousel.querySelector('.caption');

            const prev = carousel.querySelector('.prev');
            const next = carousel.querySelector('.next');

            prev.onclick = () => move(-1);
            next.onclick = () => move(1);

            function move(d) {
                idx = (idx + d + photos.length) % photos.length;
                img.src = photos[idx].pth;
                caption.textContent = photos[idx].caption || '';
            }

            // Arrow keys (only while popup is open)
            const keyHandler = e => {
                if (!carousel.isConnected) {
                    document.removeEventListener('keydown', keyHandler);
                    return;
                }
                if (e.key === 'ArrowLeft') move(-1);
                if (e.key === 'ArrowRight') move(1);
            };

            document.addEventListener('keydown', keyHandler);

            // Swipe
            let startX = null;

            img.addEventListener('touchstart', e => {
                startX = e.touches[0].clientX;
            });

            img.addEventListener('touchend', e => {
                if (startX === null) return;
                const dx = e.changedTouches[0].clientX - startX;
                if (Math.abs(dx) > 50) {
                    move(dx > 0 ? -1 : 1);
                }
                startX = null;
            });
        }

        function attachPhotoModalHandlers() {
            const modal = document.getElementById('photoModal');
            const modalImg = document.getElementById('photoModalImg');
            const caption = document.getElementById('photoModalCaption');
            const closeBtn = document.querySelector('.photo-modal-close');
            const prevBtn = document.querySelector('.modal-nav.prev');
            const nextBtn = document.querySelector('.modal-nav.next');

            let photos = [];
            let idx = 0;
            let startX = null;

            document.querySelectorAll('.photo-strip').forEach(strip => {
                strip.querySelectorAll('img').forEach((img, i) => {
                    img.onclick = () => {
                        photos = Array.from(strip.querySelectorAll('img')).map(el => ({
                            src: el.src,
                            caption: el.alt
                        }));
                        idx = i;
                        show();
                    };
                });
            });

            function show() {
                modalImg.src = photos[idx].src;
                caption.textContent = photos[idx].caption || '';
                modal.classList.add('show');
            }

            function move(d) {
                idx = (idx + d + photos.length) % photos.length;
                show();
            }

            prevBtn.onclick = () => move(-1);
            nextBtn.onclick = () => move(1);

            closeBtn.onclick = () => modal.classList.remove('show');

            modal.onclick = e => {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            };

            // Arrow keys
            document.addEventListener('keydown', e => {
                if (!modal.classList.contains('show')) {
                    return;
                }
                if (e.key === 'ArrowLeft') move(-1);
                if (e.key === 'ArrowRight') move(1);
                if (e.key === 'Escape') modal.classList.remove('show');
            });

            // Swipe
            modalImg.addEventListener('touchstart', e => {
                startX = e.touches[0].clientX;
            });

            modalImg.addEventListener('touchend', e => {
                if (startX === null) return;
                const dx = e.changedTouches[0].clientX - startX;
                if (Math.abs(dx) > 50) {
                    move(dx > 0 ? -1 : 1);
                }
                startX = null;
            });
        }



        function populateBlog() {
            const blog = document.getElementById('blog');

            blog.innerHTML = locations.filter(loc => loc.summary).map(loc => `
                <div class="blog-entry">
                    <div class="blog-title">${loc.title && loc.title.trim() ? loc.title : loc.location}</div>
                    ${loc.title ? `<div class="blog-location">${loc.location}</div>` : ''}
                    ${loc.campsites ? `<div class="blog-sites">Campsites: ${loc.campsites.join(', ')}</div>` : ''}
                    <div class="blog-date">${formatDate(loc.date_start)} - ${formatDate(loc.date_end)}</div>

                    <div class="blog-content">
                        ${loc.summary}
                    </div>

                    ${renderBlogPhotoStrip(loc.photos)}
                </div>
            `).join('');

            attachPhotoModalHandlers();
            setupBlogLazyLoading();
        }



        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        init();
    </script>
</body>
<script async data-uid="d6805045d0" src="https://colin-and-helen-vanlife.kit.com/d6805045d0/index.js"></script>

</html>